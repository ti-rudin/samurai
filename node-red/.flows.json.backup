[
    {
        "id": "c18759d07acde4e0",
        "type": "tab",
        "label": "–ü–æ—Ç–æ–∫ 1",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a1b2c3d4.56789",
        "type": "tab",
        "label": "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å –ë–æ—Ç",
        "disabled": true,
        "info": ""
    },
    {
        "id": "20f6c1bd3005a766",
        "type": "tab",
        "label": "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å –ë–æ—Ç",
        "disabled": true,
        "info": ""
    },
    {
        "id": "d1b2c3d4e5f67890",
        "type": "tab",
        "label": "HTTP Request Test",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "12345678.90abcd",
        "type": "telegram bot",
        "botname": "–ê–≤—Ç–æ—Å–µ—Ä–≤–∏—Å –ë–æ—Ç",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "testenvironment": false,
        "pollinterval": "300",
        "usesocks": false,
        "sockshost": "",
        "socksport": "",
        "socksusername": "",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbothost": "",
        "localbotport": "",
        "publicbotport": "",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": false
    },
    {
        "id": "46d9409b7f17579f",
        "type": "http in",
        "z": "c18759d07acde4e0",
        "name": "",
        "url": "/ai-opis",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 110,
        "y": 100,
        "wires": [
            [
                "7b2b03b1586d15b6",
                "8c9726728262bd4d"
            ]
        ]
    },
    {
        "id": "32ff0fab3eb4644a",
        "type": "http response",
        "z": "c18759d07acde4e0",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 120,
        "y": 160,
        "wires": []
    },
    {
        "id": "7b2b03b1586d15b6",
        "type": "function",
        "z": "c18759d07acde4e0",
        "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Yandex GPT",
        "func": "// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\nconst FOLDER_ID = env.get('YANDEX_GPT_FOLDER_ID');\nconst IAM_TOKEN = flow.get('iamToken');\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è Yandex GPT API\n\nmsg = {\n\n  payload: {\n    \"modelUri\": `gpt://${FOLDER_ID}/yandexgpt/latest`,\n    \"jsonObject\": true,\n    \"completionOptions\": {\n      \"maxTokens\": 2000,\n      \"temperature\": 0.3\n    },\n    \"messages\": [\n      {\n        \"role\": \"system\",\n        \"text\": \"–¢—ã ‚Äî AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞ ¬´–ê–≤—Ç–æ–∫–ª—É–± –°–∞–º—É—Ä–∞–π¬ª. –¢–≤–æ—è —Ä–æ–ª—å ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON-–æ—Ç–≤–µ—Ç—ã –ø–æ –∑–∞—è–≤–∫–∞–º –Ω–∞ —Ä–µ–º–æ–Ω—Ç –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π. \\n\\n–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:\\n\\n1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞**: –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–π –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã:\\n   - works: –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–±–æ—Ç—ã\\n   - parts: –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏\\n   - recommendedWorks: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–∞–±–æ—Ç—ã\\n   - recommendedParts: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏\\n   - notes: —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è\\n\\n2. **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**:\\n   - –î–ª—è —Ä–∞–±–æ—Ç: –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, —Å—Ç–æ–∏–º–æ—Å—Ç—å, —Å—Ç–∞—Ç—É—Å (–≤—Å–µ–≥–¥–∞ ¬´pending¬ª), —Ñ–ª–∞–≥ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\\n   - –î–ª—è –∑–∞–ø—á–∞—Å—Ç–µ–π: –Ω–æ–º–µ—Ä, –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞ (–≤—Å–µ–≥–¥–∞ 0), —Å—Ç–∞—Ç—É—Å (–≤—Å–µ–≥–¥–∞ ¬´pending_from_client¬ª), —Ñ–ª–∞–≥ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\\n   - –í –æ–ø–∏—Å–∞–Ω–∏–∏ —Ä–∞–±–æ—Ç –¥–µ—Ç–∞–ª–∏–∑–∏—Ä—É–π –∫–ª—é—á–µ–≤—ã–µ —ç—Ç–∞–ø—ã\\n   - –£–∫–∞–∑—ã–≤–∞–π 0000 –ø–æ–ª–µ number \\n\\n3. **–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏**:\\n   –Ω–∞–π–¥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ—Ä–º–æ-—á–∞—Å–∞—Ö (—Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 15 –º–∏–Ω) –ø–æ –≤–∏–¥–∞–º —Ä–∞–±–æ—Ç –∏ —É–º–Ω–æ–∂—å –Ω–∞ –ø–æ—á–∞—Å–æ–≤—É—é —Å—Ç–∞–≤–∫—É- –°—Ç–∞–≤–∫–∞: \"+ msg.payload.hourlyRate +\" —Ä—É–±./—á–∞—Å)\\n –µ—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–æ—Ä–º–µ-—á–∞—Å–∞—Ö –Ω–µ—Ç, –∏—â–∏ —Å—Ä–µ–¥–Ω–µ—Ä—ã–Ω–æ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã\\n  - –î–ª—è –∑–∞–ø—á–∞—Å—Ç–µ–π —É–∫–∞–∑—ã–≤–∞–π 0000\\n\\n4. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:\\n    - –î–æ–±–∞–≤–ª—è–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –º–∞—Ä–∫–∏/–º–æ–¥–µ–ª–∏ –∞–≤—Ç–æ\\n   - –í notes –≤–∫–ª—é—á–∞–π –≤–∞–∂–Ω—ã–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è\\n\\n5. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:\\n   - –í recommendedWorks –≤–∫–ª—é—á–∞–π —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∏ –ø—Ä–µ–≤–µ–Ω—Ç–∏–≤–Ω—ã–µ —Ä–∞–±–æ—Ç—ã\\n   - –í recommendedParts ‚Äî —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏ –∏ —Å–º–µ–∂–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏\\n   - –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–º–µ—á–∞–π isRecomended: true\\n\\n6. **–°—Ç–∏–ª—å**:\\n   - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —è–∑—ã–∫, –∑–∞–º–µ–Ω—è–π —Å–ª—ç–Ω–≥–æ–≤—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ \\n   - –ß–µ—Ç–∫–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤\\n   - –ë–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π, —Å–∫–∏–¥–æ–∫, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö —Ñ—Ä–∞–∑\\n\\n–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:\\n{\\n  \\\"works\\\": [{\\\"name\\\": \\\"...\\\", \\\"description\\\": \\\"...\\\", \\\"cost\\\": 1000, \\\"status_of_work\\\": \\\"pending\\\", \\\"isRecomended\\\": false}],\\n  \\\"parts\\\": [{\\\"number\\\": \\\"...\\\", \\\"name\\\": \\\"...\\\", \\\"quantity\\\": 1, \\\"price\\\": 2000, \\\"partstatus\\\": \\\"need_to_order\\\", \\\"isRecomended\\\": false}],\\n  \\\"recommendedWorks\\\": [...],\\n  \\\"recommendedParts\\\": [...],\\n  \\\"notes\\\": \\\"...\\\"\\n}\\n\\n\"\n      },\n      {\n        \"role\": \"user\",\n        \"text\": \"–ê–≤—Ç–æ–º–æ–±–∏–ª—å - \" + msg.payload.car.make + \" \"+ msg.payload.car.model + \" \" + msg.payload.description\n      }\n    ]\n  },\n\n\n  headers: {\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": `Bearer ${IAM_TOKEN}`,\n    \"x-folder-id\": FOLDER_ID\n  },\n  res: msg.res,\n  req: msg.req\n}\n\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 100,
        "wires": [
            [
                "79f6c84d9e59ac2c"
            ]
        ]
    },
    {
        "id": "79f6c84d9e59ac2c",
        "type": "http request",
        "z": "c18759d07acde4e0",
        "name": "–ó–∞–ø—Ä–æ—Å –∫ Yandex GPT API",
        "method": "POST",
        "ret": "json",
        "paytoqs": "ignore",
        "url": "https://llm.api.cloud.yandex.net/foundationModels/v1/completion",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 680,
        "y": 100,
        "wires": [
            [
                "4b49d67519515950",
                "3449c506d1b4d12c"
            ]
        ]
    },
    {
        "id": "9d6b1ed1fb3f7992",
        "type": "function",
        "z": "c18759d07acde4e0",
        "name": "–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞",
        "func": "//  const response = JSON.parse(msg.payload);\n//msg.payload = response.result?.alternatives?.[0]?.message?.text?.replace(/```/g, '').trim();\n\n\n//onst response = JSON.parse(msg.payload);\nconst response2 = msg.payload.result?.alternatives?.[0]?.message?.text;\nmsg.payload = JSON.parse(response2)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 100,
        "wires": [
            [
                "32ff0fab3eb4644a"
            ]
        ]
    },
    {
        "id": "4b49d67519515950",
        "type": "json",
        "z": "c18759d07acde4e0",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 890,
        "y": 100,
        "wires": [
            [
                "9d6b1ed1fb3f7992"
            ]
        ]
    },
    {
        "id": "3449c506d1b4d12c",
        "type": "debug",
        "z": "c18759d07acde4e0",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 40,
        "wires": []
    },
    {
        "id": "6cad9ff9aef963d8",
        "type": "inject",
        "z": "c18759d07acde4e0",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "39600",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 600,
        "wires": [
            [
                "98449c58da5eb596"
            ]
        ]
    },
    {
        "id": "98449c58da5eb596",
        "type": "function",
        "z": "c18759d07acde4e0",
        "name": "–ü–æ–ª—É—á–µ–Ω–∏–µ IAM —Ç–æ–∫–µ–Ω–∞",
        "func": "// –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è\nconst oauthToken = env.get('YANDEX_PASSPORT_OAUTH_TOKEN');\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞\nmsg.payload = {\n    \"yandexPassportOauthToken\": oauthToken\n};\n\n// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏\nmsg.headers = {\n    \"Content-Type\": \"application/json\"\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 330,
        "y": 600,
        "wires": [
            [
                "iam_request_node",
                "f1ae459a71b748b5"
            ]
        ]
    },
    {
        "id": "iam_request_node",
        "type": "http request",
        "z": "c18759d07acde4e0",
        "name": "IAM —Ç–æ–∫–µ–Ω –∑–∞–ø—Ä–æ—Å",
        "method": "POST",
        "ret": "json",
        "paytoqs": "ignore",
        "url": "https://iam.api.cloud.yandex.net/iam/v1/tokens",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 570,
        "y": 600,
        "wires": [
            [
                "3d073725e82f0812"
            ]
        ]
    },
    {
        "id": "3d073725e82f0812",
        "type": "json",
        "z": "c18759d07acde4e0",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 750,
        "y": 600,
        "wires": [
            [
                "7ee2ccbbaa3ae53e"
            ]
        ]
    },
    {
        "id": "7ee2ccbbaa3ae53e",
        "type": "function",
        "z": "c18759d07acde4e0",
        "name": "flow.set(\"iamToken\", msg.payload.iamToken)",
        "func": "flow.set(\"iamToken\", msg.payload.iamToken)\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "e342a44592b692f7",
        "type": "comment",
        "z": "c18759d07acde4e0",
        "name": "–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Ä–∞–∑ –≤ 11 —á–∞—Å–æ–≤",
        "info": "",
        "x": 160,
        "y": 560,
        "wires": []
    },
    {
        "id": "39ea9e128cf1b10d",
        "type": "http in",
        "z": "c18759d07acde4e0",
        "name": "",
        "url": "/ai-pts-recognize",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 280,
        "wires": [
            [
                "cda2656eb249c551"
            ]
        ]
    },
    {
        "id": "aa909b43669c450b",
        "type": "http response",
        "z": "c18759d07acde4e0",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 120,
        "y": 340,
        "wires": []
    },
    {
        "id": "cda2656eb249c551",
        "type": "function",
        "z": "c18759d07acde4e0",
        "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Yandex GPT",
        "func": "// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\nconst FOLDER_ID = env.get('YANDEX_VISION_FOLDER_ID');\nconst IAM_TOKEN = flow.get('iamToken');\n\n// –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–æ –≤ base64 –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ msg.payload.image\nconst imageData = msg.payload.img;\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è Yandex Vision API\nmsg.payload = {\n    \"folderId\": FOLDER_ID,\n    \"analyze_specs\": [{\n        \"content\": imageData,\n        \"features\": [{\n            \"type\": \"TEXT_DETECTION\",\n            \"text_detection_config\": {\n                \"language_codes\": [\"*\"], // –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤\n                \"model\": \"vehicle-registration-back\" // –£–∫–∞–∑–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∑–∞–¥–Ω–µ–π —Å—Ç–æ—Ä–æ–Ω—ã –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤\n            }\n        }]\n    }]\n};\n\nmsg.headers = {\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": `Bearer ${IAM_TOKEN}`\n};\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 280,
        "wires": [
            [
                "73bf07304c2a57ab"
            ]
        ]
    },
    {
        "id": "73bf07304c2a57ab",
        "type": "http request",
        "z": "c18759d07acde4e0",
        "name": "–ó–∞–ø—Ä–æ—Å –∫ Yandex GPT API",
        "method": "POST",
        "ret": "json",
        "paytoqs": "ignore",
        "url": "https://vision.api.cloud.yandex.net/vision/v1/batchAnalyze",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 720,
        "y": 280,
        "wires": [
            [
                "27638bfbf8d5a6d4",
                "7201b9b195cf6f0b"
            ]
        ]
    },
    {
        "id": "7201b9b195cf6f0b",
        "type": "function",
        "z": "c18759d07acde4e0",
        "name": "–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞",
        "func": "//  const response = JSON.parse(msg.payload);\n//msg.payload = response.result?.alternatives?.[0]?.message?.text?.replace(/```/g, '').trim();\n\n\nconst response = JSON.parse(msg.payload);\nconst response2 = response.results[0]?.results[0]?.textDetection?.pages[0]?.entities\nmsg.payload = response2;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 280,
        "wires": [
            [
                "aa909b43669c450b",
                "9dcaebeb533dfbab"
            ]
        ]
    },
    {
        "id": "27638bfbf8d5a6d4",
        "type": "debug",
        "z": "c18759d07acde4e0",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 940,
        "y": 220,
        "wires": []
    },
    {
        "id": "9dcaebeb533dfbab",
        "type": "debug",
        "z": "c18759d07acde4e0",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1300,
        "y": 280,
        "wires": []
    },
    {
        "id": "8c9726728262bd4d",
        "type": "debug",
        "z": "c18759d07acde4e0",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 280,
        "y": 60,
        "wires": []
    },
    {
        "id": "f1ae459a71b748b5",
        "type": "debug",
        "z": "c18759d07acde4e0",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 640,
        "wires": []
    },
    {
        "id": "f7cef455b73ef2c6",
        "type": "telegram receiver",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 140,
        "y": 120,
        "wires": [
            [
                "d2b51d8dc5812b38"
            ],
            []
        ]
    },
    {
        "id": "596314b0094cb77a",
        "type": "telegram sender",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "haserroroutput": false,
        "outputs": 1,
        "x": 770,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "22d6d8302914e2ea",
        "type": "inject",
        "z": "a1b2c3d4.56789",
        "name": "–ó–∞–ø—É—Å–∫",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 60,
        "wires": [
            [
                "c4cf040c5a7416ae"
            ]
        ]
    },
    {
        "id": "86d9b406c6068262",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫",
        "func": "// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å—Å–∏–≤ –≤ –æ–±—ä–µ–∫—Ç\nconst settings = {};\nmsg.payload.forEach(item => {\n    if (item.key && item.value) {\n        settings[item.key] = item.value;\n    }\n});\n\n// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç\nflow.set('settings', settings);\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\nreturn { \n    payload: settings,\n    settings: settings // –î—É–±–ª–∏—Ä—É–µ–º –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞\n};",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 60,
        "wires": [
            [
                "f0c99edd50f036ed"
            ]
        ]
    },
    {
        "id": "f0c99edd50f036ed",
        "type": "debug",
        "z": "a1b2c3d4.56789",
        "name": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
        "active": true,
        "console": "false",
        "complete": "payload",
        "x": 770,
        "y": 20,
        "wires": []
    },
    {
        "id": "c4cf040c5a7416ae",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "GET /settings",
        "method": "GET",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "http://strapi:1337/settings",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [
            {
                "keyType": "Authorization",
                "keyValue": "",
                "valueType": "other",
                "valueValue": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwiaWF0IjoxNzUyMTUzNjc4LCJleHAiOjE3NTQ3NDU2Nzh9.mUajiuHuj0l6ZmNLp9SowBTB8C_cQEvdCEDn2DXXUaY"
            }
        ],
        "x": 350,
        "y": 60,
        "wires": [
            [
                "86d9b406c6068262"
            ]
        ]
    },
    {
        "id": "987e4163e6b9a981",
        "type": "telegram sender",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "haserroroutput": false,
        "outputs": 1,
        "x": 990,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "1a8f14b172c279e4",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–°–æ–∑–¥–∞–Ω–∏–µ Car Project",
        "func": "if (msg.payload.action === \"create_car_project\") {\n    // 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞\n    const carProjectData = {\n        \"date_start\": new Date().toISOString(),\n        \"name\": `–ü—Ä–æ–µ–∫—Ç –¥–ª—è ${msg.payload.car_number}`,\n        \"status\": \"active\",\n        \"chat_id\": msg.payload.chatId.toString(),\n        \"car\": `${msg.payload.car_number}`\n    };\n\n    // 2. –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram (–ø–µ—Ä–≤—ã–π –≤—ã—Ö–æ–¥)\n    const telegramMsg = {\n        payload: {\n            chatId: msg.payload.chatId,\n            type: \"message\",\n            content: `‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –º–∞—à–∏–Ω—ã: ${msg.payload.car_number}`,\n            replyMarkup: { remove_keyboard: true }\n        }\n    };\n\n    // 3. –î–∞–Ω–Ω—ã–µ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–∞ (–≤—Ç–æ—Ä–æ–π –≤—ã—Ö–æ–¥)\n    const apiRequestMsg = {\n        payload: carProjectData,\n        originalChatId: msg.payload.chatId,\n        headers: {\n            \"Content-Type\": \"application/json\",\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n        }\n    };\n\n    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º multiple outputs)\n    return [telegramMsg, apiRequestMsg];\n    return msg;\n}\n\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 400,
        "wires": [
            [
                "987e4163e6b9a981"
            ],
            [
                "e583d7e485f4ae8c"
            ]
        ]
    },
    {
        "id": "d2b51d8dc5812b38",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π",
        "func": "try {\n    // –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏\n    if (!msg.originalMessage || !msg.payload) {\n        throw new Error(\"–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è\");\n    }\n\n    // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π\n    const full_info = {\n        user_tag: msg.originalMessage.from.username,\n        content: msg.payload.content.trim(),\n        date: msg.payload.date || new Date().toISOString(),\n        chatId: msg.originalMessage.chat.id\n    };\n\n    msg.userTag = msg.originalMessage.from.username;\n\n    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–∂–∏–¥–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –º–∞—à–∏–Ω—ã\n    const waitingKey = `waiting_car_${full_info.chatId}`;\n    if (flow.get(waitingKey)) {\n        flow.set(waitingKey, false); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥\n\n        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã –Ω–æ–º–µ—Ä–∞\n        if (full_info.content.length < 3) {\n            return {\n                payload: {\n                    chatId: full_info.chatId,\n                    type: \"message\",\n                    content: \"‚ùå –ù–æ–º–µ—Ä/VIN —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π\",\n                    replyMarkup: { remove_keyboard: true }\n                }\n            };\n        }\n\n        return [null, {\n            payload: {\n                ...full_info,\n                action: \"create_car_project\",\n                car_number: full_info.content\n            }\n        }];\n    }\n\n    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥\n    switch (full_info.content.toLowerCase()) {\n        case '/start':\n            flow.set(waitingKey, true);\n            return {\n                payload: {\n                    chatId: full_info.chatId,\n                    type: \"message\",\n                    content: \"üöó –í–≤–µ–¥–∏—Ç–µ VIN –∏–ª–∏ –Ω–æ–º–µ—Ä –º–∞—à–∏–Ω—ã:\",\n                    replyMarkup: { remove_keyboard: true }\n                }\n            };\n\n        case '–ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å':\n            return [null, {\n                payload: {\n                    ...full_info,\n                    action: \"confirm_works\"\n                }\n            }];\n            \n        case '/–∏—Ç–æ–≥':\n        case '–∏—Ç–æ–≥':\n            return [null, {\n                payload: {\n                    ...full_info,\n                    action: \"calculate_hours\"\n                }\n            }];\n        case '/reg':\n            return [null, {\n                payload: {\n                    ...full_info,\n                    action: \"register_worker\"\n                }\n            }];\n\n        default:\n            // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —Å—á–∏—Ç–∞–µ–º —Ä–∞–±–æ—Ç–æ–π\n            return [null, {\n                payload: {\n                    ...full_info,\n                    action: \"add_work\",\n                    service_name: full_info.content\n                }\n            }];\n    }\n} catch (error) {\n    console.error(\"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:\", error);\n    return {\n        payload: {\n            chatId: msg.originalMessage?.chat?.id,\n            type: \"message\",\n            content: \"‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞\"\n        }\n    };\n}",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 120,
        "wires": [
            [
                "596314b0094cb77a"
            ],
            [
                "1a8f14b172c279e4",
                "1a91a4ac3a8ae991",
                "8db7171cc9746c93",
                "2d248485fc28283a",
                "da9d42737b680856"
            ]
        ]
    },
    {
        "id": "e583d7e485f4ae8c",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://strapi:1337/car-projects",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 970,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "9d21d401f365d591",
        "type": "comment",
        "z": "a1b2c3d4.56789",
        "name": "",
        "info": "let full_info = {\n    \"user_tag\": msg.originalMessage.from.username,\n    \"content\": msg.payload.content,\n    \"date\": msg.payload.date,\n    \"chatId\": msg.originalMessage.chat.id,\n};\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–∂–∏–¥–∞–µ–º –ª–∏ –º—ã –Ω–æ–º–µ—Ä –º–∞—à–∏–Ω—ã –ø–æ—Å–ª–µ /start\nconst waitingForCarNumber = flow.get(`waiting_car_${full_info.chatId}`) || false;\n\nif (waitingForCarNumber) {\n    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –æ–∂–∏–¥–∞–Ω–∏—è\n    flow.set(`waiting_car_${full_info.chatId}`, false);\n    \n    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π car_project\n    return [null, {\n        payload: {\n            ...full_info,\n            action: \"create_car_project\",\n            car_number: full_info.content\n        }\n    }];\n}\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –æ–∂–∏–¥–∞–µ–º –Ω–æ–º–µ—Ä –º–∞—à–∏–Ω—ã\nif (!waitingForCarNumber) {\n    switch (full_info.content.toLowerCase()) {\n        case '/start':\n            flow.set(`waiting_car_${full_info.chatId}`, true);\n            return {\n                payload: {\n                    chatId: full_info.chatId,\n                    type: \"message\",\n                    content: \"üöó –í–≤–µ–¥–∏—Ç–µ VIN –∏–ª–∏ –Ω–æ–º–µ—Ä –º–∞—à–∏–Ω—ã:\",\n                    replyMarkup: { remove_keyboard: true }\n                }\n            };\n\n        case '–ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å':\n            if (flow.get(\"mechanic_messages\") && flow.get(\"mechanic_messages\").length > 0) {\n                return [null, { payload: full_info }];\n            } else {\n                return {\n                    payload: {\n                        chatId: full_info.chatId,\n                        type: \"message\",\n                        content: \"‚ùå –ù–µ—Ç —Ä–∞–±–æ—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\",\n                        replyMarkup: { remove_keyboard: true }\n                    }\n                };\n            }\n    }\n}\n\n// –í—Å–µ —á—Ç–æ –Ω–µ –∫–æ–º–∞–Ω–¥–∞ –∏ –Ω–µ –Ω–æ–º–µ—Ä –ø–æ—Å–ª–µ /start - —Å—á–∏—Ç–∞–µ–º —Ä–∞–±–æ—Ç–æ–π\nreturn [null, {\n    payload: {\n        ...full_info,\n        action: \"add_work\",\n        service_name: full_info.content\n    }\n}];",
        "x": 390,
        "y": 180,
        "wires": []
    },
    {
        "id": "5b7b8c47bd4b2a4c",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Yandex GPT",
        "func": "let IAM = flow.get('settings').IAM;\nconst carProjectId = msg.carProjectId; // –ü–æ–ª—É—á–∞–µ–º –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —É–∑–ª–∞\n\n    // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è Yandex GPT API\nmsg.payload = {\n    \"modelUri\": `gpt://${env.get('YANDEX_GPT_FOLDER_ID_2') || 'b1goqv6uhnf7i2fqof2p'}/yandexgpt`,\n    \"completionOptions\": {\n        \"stream\": false,\n        \"temperature\": 0.3,\n        \"maxTokens\": \"2000\",\n        \"reasoningOptions\": {\n            \"mode\": \"DISABLED\"\n        }\n    },\n    \"messages\": [\n        {\n            \"role\": \"system\",\n            \"text\": \"–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–π –∏—Ö –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—É.\\n\" +\n                \"–¢–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è: name (—É—Å–ª—É–≥–∞), status, completionDate, totalTime (–≤ —á–∞—Å–∞—Ö), totalCost (–≤ —Ä—É–±–ª—è—Ö), car_project (—Å–≤—è–∑—å —Å –∞–≤—Ç–æ).\\n\" +\n                \"–ü—Ä–∞–≤–∏–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:\\n\" +\n                \"1. –ò–∑–≤–ª–µ–∫–∞–π –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞\\n\" +\n                \"2. –ï—Å–ª–∏ –≤—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–π 0.5 —á–∞—Å–∞\\n\" +\n                \"3. –°—Ç–∞—Ç—É—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: '–í —Ä–∞–±–æ—Ç–µ'\\n\" +\n                \"4. –î–∞—Ç—É completionDate –æ—Å—Ç–∞–≤–ª—è–π –ø—É—Å—Ç–æ–π (null)\\n\" +\n                \"5. –í—Å–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —É–∫–∞–∑—ã–≤–∞–π –±–µ–∑ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)\\n\\n\" +\n                \"–û—Ç–≤–µ—á–∞–π —Å—Ç—Ä–æ–≥–æ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:\\n\" +\n                \"{\\n\" +\n                \"  \\\"records\\\": [\\n\" +\n                \"    {\\n\" +\n                \"      \\\"name\\\": string,\\n\" +\n                \"      \\\"status\\\": string,\\n\" +\n                \"      \\\"completionDate\\\": null,\\n\" +\n                \"      \\\"totalTime\\\": number,\\n\" +\n                \"      \\\"totalCost\\\": number,\\n\" +\n                \"      \\\"car_project\\\": \\\"\" + carProjectId + \"\\\"\\n\" + \n                \"    }\\n\" +\n                \"  ]\\n\" +\n                \"}\"\n        },\n        {\n            \"role\": \"user\",\n            \"text\": \"–†–∞–±–æ—Ç:\\n\" + msg.originalContent\n        }\n    ]\n};\n\nmsg.headers = {\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": `Bearer ${IAM}`\n};\n\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 880,
        "wires": [
            [
                "452618b20265856e"
            ]
        ]
    },
    {
        "id": "452618b20265856e",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ó–∞–ø—Ä–æ—Å –∫ Yandex GPT API",
        "method": "POST",
        "ret": "json",
        "paytoqs": "ignore",
        "url": "https://llm.api.cloud.yandex.net/foundationModels/v1/completion",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 660,
        "y": 880,
        "wires": [
            [
                "1a2970861e1aa5da"
            ]
        ]
    },
    {
        "id": "e0ec1405923b80f5",
        "type": "inject",
        "z": "a1b2c3d4.56789",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 860,
        "wires": [
            [
                "5b7b8c47bd4b2a4c"
            ]
        ]
    },
    {
        "id": "1a2970861e1aa5da",
        "type": "debug",
        "z": "a1b2c3d4.56789",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 880,
        "wires": []
    },
    {
        "id": "1a91a4ac3a8ae991",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—Ç",
        "func": "if (msg.payload.action === \"confirm_works\") {\n    const chatId = msg.payload.chatId;\n\n    if (!chatId) {\n        node.error(\"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç chatId\", msg);\n        return null;\n    }\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º chatId –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏\n    msg.originalChatId = chatId;\n\n    return {\n        method: \"GET\",\n        url: `http://strapi:1337/car-projects?chat_id=${chatId}&status=active&_sort=date_start:desc&_limit=1`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n        },\n        originalChatId: chatId  // –î—É–±–ª–∏—Ä—É–µ–º chatId –∑–¥–µ—Å—å\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 520,
        "wires": [
            [
                "02357cca71f74a2f"
            ]
        ]
    },
    {
        "id": "02357cca71f74a2f",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ó–∞–ø—Ä–æ—Å –ø—Ä–æ–µ–∫—Ç–∞",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 780,
        "y": 520,
        "wires": [
            [
                "0bb70c20507b47e9"
            ]
        ]
    },
    {
        "id": "0bb70c20507b47e9",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞",
        "func": "// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ –æ–±—ä–µ–∫—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\nlet project = msg.payload;\nif (typeof project === 'string') {\n    try {\n        project = JSON.parse(project);\n    } catch (e) {\n        node.error(\"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON\", msg);\n        return null;\n    }\n}\n\n// –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –º–∞—Å—Å–∏–≤ (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ), –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç\nif (Array.isArray(project)) {\n    project = project[0];\n}\n\nif (project && project.id) {\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞\n    flow.set(`project_id_${msg.originalChatId}`, project.id);\n    \n    const worksCount = project.works ? project.works.length : 0;\n    \n    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n    const userMsg = {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: worksCount > 0 \n                ? `‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ ${worksCount} —Ä–∞–±–æ—Ç. –ó–∞–∫—Ä—ã–≤–∞—é –ø—Ä–æ–µ–∫—Ç...`\n                : \"‚úÖ –ó–∞–∫—Ä—ã–≤–∞—é –ø—Ä–æ–µ–∫—Ç...\"\n        }\n    };\n    \n    // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ\n    const updateMsg = {\n        method: \"PUT\",\n        url: `http://strapi:1337/car-projects/${project.id}`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`,\n            \"Content-Type\": \"application/json\"\n        },\n        payload: {\n            status: \"completed\",\n            date_end: new Date().toISOString()\n        },\n        originalChatId: msg.originalChatId\n    };\n    \n    return [userMsg, updateMsg];\n} else {\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\"\n        }\n    };\n}",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 480,
        "wires": [
            [
                "7716908ded226f10"
            ],
            [
                "02d858965219a0a2"
            ]
        ]
    },
    {
        "id": "02d858965219a0a2",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞",
        "method": "use",
        "ret": "obj",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1140,
        "y": 540,
        "wires": [
            [
                "95fc79f7f1a8e050"
            ]
        ]
    },
    {
        "id": "7716908ded226f10",
        "type": "telegram sender",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1470,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "95fc79f7f1a8e050",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
        "func": "// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Strapi\nif (!msg.originalChatId) {\n    node.error(\"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç originalChatId –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\", msg);\n    return null;\n}\n\n\nif (msg.statusCode === 200) {\n    // –£–¥–∞–ª—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π ID –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω!\"\n        }\n    };\n} else {\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–µ–∫—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.\"\n        }\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 620,
        "wires": [
            [
                "7716908ded226f10"
            ]
        ]
    },
    {
        "id": "3e333125569567d5",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ò—â–µ–º CarID",
        "func": "if (msg.payload.action === \"add_work\") {\n    const chatId = msg.payload.chatId;\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é payload\n    msg.originalChatId = msg.payload.chatId;\n    msg.originalContent = msg.payload.content;\n\n    msg.method = \"GET\";\n    msg.url = `http://strapi:1337/car-projects?_sort=date_start:desc&chat_id=${chatId}`;\n    msg.headers = {\n        \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n    };\n\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 220,
        "wires": [
            [
                "a4433a5c16a1cb0f"
            ]
        ]
    },
    {
        "id": "a4433a5c16a1cb0f",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "car-project",
        "method": "use",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1170,
        "y": 220,
        "wires": [
            [
                "ed63f0ce7b181f00"
            ]
        ]
    },
    {
        "id": "ed63f0ce7b181f00",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–∏—Å–∫–∞",
        "func": "const responseData = typeof msg.payload === 'string' \n        ? JSON.parse(msg.payload) \n        : msg.payload;\n    \n    // 2. –ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤\n    const projects = Array.isArray(responseData) \n        ? responseData \n        : responseData.data || [];\n\nif (projects.length === 0) {\n    return {\n        payload: {\n            chatId: msg.originalChatId || msg.chatId, // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π chatId\n            type: \"message\",\n            content: \"‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç. –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç —Å –ø–æ–º–æ—â—å—é /start\",\n            replyMarkup: { remove_keyboard: true }\n        }\n    };\n}\n\n// –í—ã–±–∏—Ä–∞–µ–º —Å–∞–º—ã–π —Å–≤–µ–∂–∏–π –ø—Ä–æ–µ–∫—Ç (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —É–∂–µ —Å–¥–µ–ª–∞–Ω–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ)\nconst activeProject = projects.find(p => p.status === \"active\") || projects[0];\n\n// –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞–ª—å—à–µ\nmsg.carProjectId = activeProject.id;\nmsg.chatId = msg.originalChatId; \n\nmsg.payload.content = msg.originalContent; \n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 220,
        "wires": [
            [
                "c92038fa62531256"
            ]
        ]
    },
    {
        "id": "c92038fa62531256",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Yandex GPT",
        "func": "let IAM = flow.get('settings').IAM;\nconst carProjectId = msg.carProjectId; // –ü–æ–ª—É—á–∞–µ–º –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —É–∑–ª–∞\nif (msg.workerId) {\n    msg.payload.workers = [msg.workerId]; // –Ø–≤–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞\n}\n    // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è Yandex GPT API\nmsg.payload = {\n    \"modelUri\": `gpt://${env.get('YANDEX_GPT_FOLDER_ID_2') || 'b1goqv6uhnf7i2fqof2p'}/yandexgpt`,\n    \"completionOptions\": {\n        \"stream\": false,\n        \"temperature\": 0.3,\n        \"maxTokens\": \"2000\",\n        \"reasoningOptions\": {\n            \"mode\": \"DISABLED\"\n        }\n    },\n    \"messages\": [\n        {\n            \"role\": \"system\",\n            \"text\": \"–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–π –∏—Ö –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—É.\\n\" +\n                \"–¢–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è: name (—É—Å–ª—É–≥–∞), status, completionDate, totalTime (–≤ —á–∞—Å–∞—Ö), totalCost (–≤ —Ä—É–±–ª—è—Ö), car_project (—Å–≤—è–∑—å —Å –∞–≤—Ç–æ).\\n\" +\n                \"–ü—Ä–∞–≤–∏–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:\\n\" +\n                \"1. –ò–∑–≤–ª–µ–∫–∞–π –Ω–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞\\n\" +\n                \"2. –ï—Å–ª–∏ –≤—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–π 0.5 —á–∞—Å–∞\\n\" +\n                \"3. –°—Ç–∞—Ç—É—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: '–í —Ä–∞–±–æ—Ç–µ'\\n\" +\n                \"4. –î–∞—Ç—É completionDate –æ—Å—Ç–∞–≤–ª—è–π –ø—É—Å—Ç–æ–π (null)\\n\" +\n                \"5. –í—Å–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —É–∫–∞–∑—ã–≤–∞–π –±–µ–∑ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)\\n\\n\" +\n                \"–û—Ç–≤–µ—á–∞–π —Å—Ç—Ä–æ–≥–æ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ:\\n\" +\n                \"{\\n\" +\n                \"  \\\"records\\\": [\\n\" +\n                \"    {\\n\" +\n                \"      \\\"name\\\": string,\\n\" +\n                \"      \\\"status\\\": string,\\n\" +\n                \"      \\\"completionDate\\\": null,\\n\" +\n                \"      \\\"totalTime\\\": number,\\n\" +\n                \"      \\\"totalCost\\\": number,\\n\" +\n                \"      \\\"car_project\\\": \\\"\" + carProjectId + \"\\\"\\n\" + \n                \"    }\\n\" +\n                \"  ]\\n\" +\n                \"}\"\n        },\n        {\n            \"role\": \"user\",\n            \"text\": \"–†–∞–±–æ—Ç:\\n\" + msg.originalContent\n        }\n    ]\n};\n\nmsg.headers = {\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": `Bearer ${IAM}`\n};\n\n\nreturn msg",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 280,
        "wires": [
            [
                "729da624d917a9b0"
            ]
        ]
    },
    {
        "id": "729da624d917a9b0",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ó–∞–ø—Ä–æ—Å –∫ Yandex GPT API",
        "method": "POST",
        "ret": "json",
        "paytoqs": "ignore",
        "url": "https://llm.api.cloud.yandex.net/foundationModels/v1/completion",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1360,
        "y": 280,
        "wires": [
            [
                "5f4a707b3ca998f5"
            ]
        ]
    },
    {
        "id": "5f4a707b3ca998f5",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "function 1",
        "func": "if (msg.payload.error) {\n    node.error(\"Yandex GPT API error: \" + msg.payload.message, msg);\n    msg.payload = {\n        chatId: msg.chatId,\n        type: \"message\",\n        content: \"‚ùå –û—à–∏–±–∫–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏: \" + msg.payload.message,\n        replyMarkup: { remove_keyboard: true }\n    };\n    return msg;\n}\n\ntry {\n    const STRAPI_JWT_SECRET = flow.get('settings').STRAPI_JWT_SECRET;\n    const response = typeof msg.payload === 'string'\n        ? JSON.parse(msg.payload)\n        : msg.payload;\n\n    // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏ –æ—á–∏—â–∞–µ–º –æ—Ç–≤–µ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–∏\n    const gptText = response.result?.alternatives?.[0]?.message?.text?.replace(/```/g, '').trim();\n    if (!gptText) throw new Error(\"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–∏\");\n\n    // –ü–∞—Ä—Å–∏–º JSON\n    const gptData = JSON.parse(gptText);\n    const record = gptData.records?.[0];\n    if (!record) throw new Error(\"–ù–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ —Ä–∞–±–æ—Ç–µ\");\n\n    if (msg.workerId) {\n        msg.payload.workers = [msg.workerId]; // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –∫ —Ä–∞–±–æ—Ç–µ\n    }\n    // –§–æ—Ä–º–∏—Ä—É–µ–º payload\n    msg.payload = {\n        name: record.name || \"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —É—Å–ª—É–≥–∞\",\n        status: record.status || \"–ó–∞–≤–µ—Ä—à–µ–Ω–∞\",\n        completionDate: null,\n        totalTime: Number(record.totalTime) || 0.5,\n        totalCost: Number(record.totalCost) || 500,\n        car_project: msg.carProjectId\n    };\n\n    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º headers\n    msg.headers = {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": `Bearer ${STRAPI_JWT_SECRET}`\n    };\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞–∂–Ω—ã–µ –ø–æ–ª—è\n    msg.chatId = msg.chatId || msg.originalChatId;\n    msg.originalContent = msg.originalContent;\n    msg.workName = msg.payload.name;\n    return msg;\n\n} catch (err) {\n    node.error(\"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: \" + err.message, msg);\n    msg.payload = {\n        chatId: msg.chatId,\n        type: \"message\",\n        content: `‚ùå –û—à–∏–±–∫–∞: ${err.message}\\n\\n–ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞: \"–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞ - 3000 - 1\"`,\n        replyMarkup: { remove_keyboard: true }\n    };\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 340,
        "wires": [
            [
                "3b9a3bce79fe3c06"
            ]
        ]
    },
    {
        "id": "3b9a3bce79fe3c06",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "works",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://strapi:1337/works",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1150,
        "y": 340,
        "wires": [
            [
                "0aa673230b4a1fb9"
            ]
        ]
    },
    {
        "id": "0aa673230b4a1fb9",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "function 2",
        "func": "if (msg.statusCode === 200) {\n    const workId = typeof msg.payload === 'string'\n        ? JSON.parse(msg.payload).id\n        : msg.payload.id;\n\n    // –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏—è\n    return [{\n        payload: {\n            chatId: msg.chatId || msg.originalChatId,\n            type: \"message\",\n            content: `‚úÖ –†–∞–±–æ—Ç–∞ \"${msg.workName}\" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞`,\n            replyMarkup: { remove_keyboard: true }\n        }\n    }, {\n        method: \"PUT\",\n        url: `http://strapi:1337/works/${workId}`,\n        headers: {\n            \"Content-Type\": \"application/json\",\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n        },\n        payload: {\n            workers: [msg.workerId] // –Ø–≤–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º —Ä–∞–±–æ—Ç–Ω–∏–∫–∞\n        },\n        originalChatId: msg.chatId,\n        workName: msg.workName\n    }];\n} else {\n    return {\n        payload: {\n            chatId: msg.chatId,\n            type: \"message\",\n            content: \"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã\",\n            replyMarkup: { remove_keyboard: true }\n        }\n    };\n}",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 340,
        "wires": [
            [
                "86edbbc35a5cba8c"
            ],
            [
                "new_put_request_node"
            ]
        ]
    },
    {
        "id": "86edbbc35a5cba8c",
        "type": "telegram sender",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1610,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "8db7171cc9746c93",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        "func": "if (msg.payload.action === \"add_work\") {\n    const userTag = msg.payload.user_tag;\n    const chatId = msg.payload.chatId;\n\n    if (!userTag) {\n        return {\n            payload: {\n                chatId: chatId,\n                type: \"message\",\n                content: \"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à user_tag\",\n                replyMarkup: { remove_keyboard: true }\n            }\n        };\n    }\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n    msg._original = {\n        content: msg.payload.content,\n        chatId: chatId,\n        userTag: userTag\n    };\n\n    // –ó–∞–ø—Ä–æ—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞–±–æ—Ç–Ω–∏–∫–µ\n    msg.method = \"GET\";\n    msg.url = `http://strapi:1337/workers?user_tag=${userTag}&_limit=1`;\n    msg.headers = {\n        \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n    };\n\n    return msg;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 180,
        "wires": [
            [
                "8875926353c5f43e"
            ]
        ]
    },
    {
        "id": "8875926353c5f43e",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        "method": "use",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 990,
        "y": 180,
        "wires": [
            [
                "9a2f43b17ed00e9d"
            ]
        ]
    },
    {
        "id": "9a2f43b17ed00e9d",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏",
        "func": "const response = typeof msg.payload === 'string'\n    ? JSON.parse(msg.payload)\n    : msg.payload;\n\n// –í—ã—Ö–æ–¥ 2 (–æ—à–∏–±–∫–∞): –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω\nif (!Array.isArray(response) || response.length === 0) {\n    return [null, {\n        payload: {\n            chatId: msg._original.chatId,\n            type: \"message\",\n            content: \"‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ /reg\",\n            replyMarkup: { remove_keyboard: true }\n        }\n    }];\n}\n\n// –í—ã—Ö–æ–¥ 1: –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫\nreturn [{\n    ...msg,\n    payload: {\n        action: \"add_work\",\n        chatId: msg._original.chatId,\n        content: msg._original.content,\n        user_tag: msg._original.userTag\n    },\n    workerId: response[0].id\n}, null];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 240,
        "wires": [
            [
                "3e333125569567d5"
            ],
            [
                "21f83d2164b3c59b"
            ]
        ]
    },
    {
        "id": "21f83d2164b3c59b",
        "type": "telegram sender",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "haserroroutput": false,
        "outputs": 1,
        "x": 770,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "new_put_request_node",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ü—Ä–∏–≤—è–∑–∫–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –∫ —Ä–∞–±–æ—Ç–µ",
        "method": "use",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1310,
        "y": 400,
        "wires": [
            [
                "new_response_handler"
            ]
        ]
    },
    {
        "id": "new_response_handler",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞",
        "func": "if (msg.statusCode === 200) {\n    node.log(`–†–∞–±–æ—Ç–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ä–∞–±–æ—Ç–µ: ${msg.workName}`);\n} else {\n    node.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞: ${msg.payload}`);\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚ö†Ô∏è –†–∞–±–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞, –Ω–æ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Ä–∞–±–æ—Ç–Ω–∏–∫—É\"\n        }\n    };\n}\n\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1600,
        "y": 400,
        "wires": [
            [
                "9f9daa0c1b381f5e"
            ]
        ]
    },
    {
        "id": "9f9daa0c1b381f5e",
        "type": "telegram sender",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1850,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "2d248485fc28283a",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞",
        "func": "if (msg.payload.action === \"register_worker\") {\n    const userTag = msg.payload.user_tag;\n    const chatId = msg.payload.chatId;\n\n    if (!userTag) {\n        return {\n            payload: {\n                chatId: chatId,\n                type: \"message\",\n                content: \"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à user_tag\"\n            }\n        };\n    }\n\n    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞\n    return {\n        method: \"GET\",\n        url: `http://strapi:1337/workers?user_tag=${userTag}`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n        },\n        originalChatId: chatId,\n        userTag: userTag\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 120,
        "wires": [
            [
                "cc02e5a75c6e9b19"
            ]
        ]
    },
    {
        "id": "cc02e5a75c6e9b19",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞",
        "method": "use",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 990,
        "y": 120,
        "wires": [
            [
                "848516deb6144e9c"
            ]
        ]
    },
    {
        "id": "848516deb6144e9c",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏",
        "func": "const response = typeof msg.payload === 'string' ? JSON.parse(msg.payload) : msg.payload;\nconst chatId = msg.originalChatId;\nconst userTag = msg.userTag;\n\n// –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –≤—ã—Ö–æ–¥ 1\nif (Array.isArray(response) && response.length > 0) {\n    return [{\n        payload: {\n            chatId: chatId,\n            type: \"message\",\n            content: `‚ÑπÔ∏è –í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã (ID: ${response[0].id})`\n        }\n    }, null];\n}\n\n// –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –Ω–µ—Ç - –≤—ã—Ö–æ–¥ 2\nreturn [null, {\n    method: \"POST\",\n    url: \"http://strapi:1337/workers\",\n    headers: {\n        \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`,\n        \"Content-Type\": \"application/json\"\n    },\n    payload: {\n        user_tag: userTag,\n        hourly_rate: 0\n    },\n    originalChatId: chatId\n}];",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 120,
        "wires": [
            [
                "28787561733bbe87"
            ],
            [
                "d41de4345a02df97"
            ]
        ]
    },
    {
        "id": "d41de4345a02df97",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://strapi:1337/workers",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1460,
        "y": 160,
        "wires": [
            [
                "56b68511c9ce27db"
            ]
        ]
    },
    {
        "id": "56b68511c9ce27db",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        "func": "const response = typeof msg.payload === 'string' ? JSON.parse(msg.payload) : msg.payload;\nconst chatId = msg.originalChatId;\n\nif (response.id) {\n    return {\n        payload: {\n            chatId: chatId,\n            type: \"message\",\n            content: `‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã (ID: ${response.id})`\n        }\n    };\n} else {\n    return {\n        payload: {\n            chatId: chatId,\n            type: \"message\",\n            content: \"‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: \" + (response.message || JSON.stringify(response))\n        }\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1710,
        "y": 160,
        "wires": [
            [
                "28787561733bbe87"
            ]
        ]
    },
    {
        "id": "28787561733bbe87",
        "type": "telegram sender",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1950,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "34b2c4c0fa627bd7",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ó–∞–ø—Ä–æ—Å –ø—Ä–æ–µ–∫—Ç–æ–≤",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 630,
        "y": 580,
        "wires": [
            [
                "f7b4385e016dab57"
            ]
        ]
    },
    {
        "id": "f7b4385e016dab57",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤",
        "func": "try {\n    const projects = typeof msg.payload === 'string' \n        ? JSON.parse(msg.payload) \n        : msg.payload;\n    \n    const userTag = msg.userTag;\n    const chatId = msg.originalChatId;\n\n    if (!Array.isArray(projects) || projects.length === 0) {\n        return {\n            payload: {\n                chatId: chatId,\n                type: \"message\",\n                content: \"‚ÑπÔ∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü\"\n            }\n        };\n    }\n\n    // –ü–æ–ª—É—á–∞–µ–º ID –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤\n    const projectIds = projects.map(p => p.id);\n    \n    // –¢–µ–ø–µ—Ä—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–±–æ—Ç—ã –¥–ª—è —ç—Ç–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞\n    return {\n        method: \"GET\",\n        url: `http://strapi:1337/works?` +\n            `workers.user_tag=${userTag}&` +\n            `car_project.id_in=${projectIds.join(',')}&` +\n            `_limit=1`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n        },\n        originalChatId: chatId,\n        userTag: userTag\n    };\n} catch (err) {\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: \" + err.message\n        }\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 850,
        "y": 620,
        "wires": [
            [
                "79427b042710cf97"
            ]
        ]
    },
    {
        "id": "79427b042710cf97",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ó–∞–ø—Ä–æ—Å —Ä–∞–±–æ—Ç",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1070,
        "y": 620,
        "wires": [
            [
                "9a16284633cacce3"
            ]
        ]
    },
    {
        "id": "9a16284633cacce3",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–§–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç —á–∞—Å–æ–≤",
        "func": "try {\n    const works = typeof msg.payload === 'string' \n        ? JSON.parse(msg.payload) \n        : msg.payload;\n    \n    const chatId = msg.originalChatId;\n    const userTag = msg.userTag;\n    \n    if (!Array.isArray(works) || works.length === 0) {\n        return {\n            payload: {\n                chatId: chatId,\n                type: \"message\",\n                content: \"‚ÑπÔ∏è –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Ä–∞–±–æ—Ç —Å –≤–∞—à–∏–º —É—á–∞—Å—Ç–∏–µ–º\"\n            }\n        };\n    }\n    \n    // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –≤—Ä–µ–º—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å\n    let totalHours = 0;\n    let totalCost = 0;\n    \n    works.forEach(work => {\n        totalHours += work.totalTime || 0;\n        totalCost += work.totalCost || 0;\n    });\n    \n    // –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç\n    const responseText = `üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü:\\n` +\n                       `‚Ä¢ –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞–±–æ—Ç: ${works.length}\\n` +\n                       `‚Ä¢ –í—Å–µ–≥–æ —á–∞—Å–æ–≤: ${totalHours.toFixed(1)}\\n` +\n                       `‚Ä¢ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${totalCost.toFixed(2)} —Ä—É–±.`;\n    \n    return {\n        payload: {\n            chatId: chatId,\n            type: \"message\",\n            content: responseText\n        }\n    };\n} catch (err) {\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: \" + err.message\n        }\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 680,
        "wires": [
            [
                "0c1bfde19c136ccc"
            ]
        ]
    },
    {
        "id": "0c1bfde19c136ccc",
        "type": "telegram sender",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1390,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "da9d42737b680856",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ü–æ–¥—Å—á–µ—Ç —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç",
        "func": "if (msg.payload.action === \"calculate_hours\") {\n    const userTag = msg.payload.user_tag || msg.userTag;\n    const chatId = msg.payload.chatId;\n\n    if (!userTag) {\n        return {\n            payload: {\n                chatId: chatId,\n                type: \"message\",\n                content: \"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–µ–≥\"\n            }\n        };\n    }\n\n    // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞—Å—á–µ—Ç –¥–∞—Ç—ã (–º–µ—Å—è—Ü –Ω–∞–∑–∞–¥)\n    const oneMonthAgo = new Date();\n    oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);\n    const dateString = oneMonthAgo.toISOString();\n\n    // –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º –≤—Å–µ –ø—Ä–æ–µ–∫—Ç—ã –∑–∞ –ø–µ—Ä–∏–æ–¥\n    return {\n        method: \"GET\",\n        url: `http://strapi:1337/car-projects?` +\n            `chat_id=${chatId}&` +\n            `date_start=${dateString}&` +\n            `_limit=1`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n        },\n        originalChatId: chatId,\n        userTag: userTag\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 580,
        "wires": [
            [
                "34b2c4c0fa627bd7"
            ]
        ]
    },
    {
        "id": "9ad6f7a23270f596",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ü–æ–¥—Å—á–µ—Ç —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç",
        "func": "if (msg.payload.action === \"calculate_hours\") {\n    const userTag = msg.payload.user_tag || msg.userTag;\n    const chatId = msg.payload.chatId;\n\n    if (!userTag) {\n        return {\n            payload: {\n                chatId: chatId,\n                type: \"message\",\n                content: \"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–µ–≥\"\n            }\n        };\n    }\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —É–∑–ª–æ–≤\n    msg.originalChatId = chatId;\n    msg.userTag = userTag;\n    \n    // 1. –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º —Ä–∞–±–æ—Ç–Ω–∏–∫–∞\n    return {\n        method: \"GET\",\n        url: `http://strapi:1337/workers?user_tag=${userTag}&_limit=1`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n        },\n        originalChatId: chatId,\n        userTag: userTag\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 700,
        "wires": [
            [
                "d2ea625fa8328d78"
            ]
        ]
    },
    {
        "id": "d2ea625fa8328d78",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ó–∞–ø—Ä–æ—Å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 590,
        "y": 700,
        "wires": [
            [
                "ba526ff3f7e757a8"
            ]
        ]
    },
    {
        "id": "ba526ff3f7e757a8",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞",
        "func": "try {\n    const worker = typeof msg.payload === 'string' \n        ? JSON.parse(msg.payload) \n        : msg.payload;\n    \n    const userTag = msg.userTag;\n    const chatId = msg.originalChatId;\n\n    if (!Array.isArray(worker) || worker.length === 0) {\n        return {\n            payload: {\n                chatId: chatId,\n                type: \"message\",\n                content: \"‚ùå –†–∞–±–æ—Ç–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ /reg\"\n            }\n        };\n    }\n\n    // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –∏ –µ–≥–æ –ø–æ—á–∞—Å–æ–≤—É—é —Å—Ç–∞–≤–∫—É\n    msg.workerId = worker[0].id;\n    msg.hourlyRate = worker[0].hourly_rate || 0;\n    \n    // 2. –ù–∞—Ö–æ–¥–∏–º –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞\n    return {\n        method: \"GET\",\n        url: `http://strapi:1337/car-projects?chat_id=${chatId}&status=active&_limit=1`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n        },\n        originalChatId: chatId,\n        workerId: msg.workerId,\n        hourlyRate: msg.hourlyRate\n    };\n} catch (err) {\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–∞: \" + err.message\n        }\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 740,
        "wires": [
            [
                "62409b1b04b165ef"
            ]
        ]
    },
    {
        "id": "62409b1b04b165ef",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–ó–∞–ø—Ä–æ—Å –ø—Ä–æ–µ–∫—Ç–∞",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1030,
        "y": 740,
        "wires": [
            [
                "6da1df1e454bb2e8"
            ]
        ]
    },
    {
        "id": "6da1df1e454bb2e8",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞",
        "func": "try {\n    const project = typeof msg.payload === 'string' \n        ? JSON.parse(msg.payload) \n        : msg.payload;\n    \n    const chatId = msg.originalChatId;\n    const workerId = msg.workerId;\n    const hourlyRate = msg.hourlyRate;\n    \n    if (!Array.isArray(project) || project.length === 0) {\n        return {\n            payload: {\n                chatId: chatId,\n                type: \"message\",\n                content: \"‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞\"\n            }\n        };\n    }\n    \n    const projectId = project[0].id;\n    \n    // 3. –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Ä–∞–±–æ—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞\n    return {\n        method: \"GET\",\n        url: `http://strapi:1337/works?` +\n            `car_project.id=${projectId}&` +\n            `workers.id=${workerId}&` +\n            `_limit=100`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`\n        },\n        originalChatId: chatId,\n        workerId: workerId,\n        hourlyRate: hourlyRate,\n        projectId: projectId\n    };\n} catch (err) {\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞: \" + err.message\n        }\n    };\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1080,
        "y": 800,
        "wires": [
            [
                "a49f056791460a69"
            ]
        ]
    },
    {
        "id": "a49f056791460a69",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–§–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç",
        "func": "try {\n    const works = typeof msg.payload === 'string' \n        ? JSON.parse(msg.payload) \n        : msg.payload;\n    \n    const chatId = msg.originalChatId;\n    const hourlyRate = msg.hourlyRate;\n    const projectId = msg.projectId;\n    \n    if (!Array.isArray(works) || works.length === 0) {\n        return {\n            payload: {\n                chatId: chatId,\n                type: \"message\",\n                content: \"‚ÑπÔ∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ä–∞–±–æ—Ç –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞\"\n            }\n        };\n    }\n    \n    // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –≤—Ä–µ–º—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å\n    let totalHours = 0;\n    let totalCost = 0;\n    \n    works.forEach(work => {\n        totalHours += work.totalTime || 0;\n        totalCost += work.totalCost || 0;\n    });\n    \n    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–∞—Ä–ø–ª–∞—Ç—É —Ä–∞–±–æ—Ç–Ω–∏–∫–∞\n    const salary = totalHours * hourlyRate;\n    \n    // –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç\n    const responseText = `üìä –ò—Ç–æ–≥ –ø–æ –ø—Ä–æ–µ–∫—Ç—É:\\n` +\n                       `‚Ä¢ –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Ä–∞–±–æ—Ç: ${works.length}\\n` +\n                       `‚Ä¢ –í—Å–µ–≥–æ —á–∞—Å–æ–≤: ${totalHours.toFixed(1)}\\n` +\n                       `‚Ä¢ –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${totalCost.toFixed(2)} —Ä—É–±.\\n` +\n                       `‚Ä¢ –í–∞—à–∞ –∑–∞—Ä–ø–ª–∞—Ç–∞: ${salary.toFixed(2)} —Ä—É–±.`;\n    \n    // 4. –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–µ–∫—Ç\n    return [{\n        payload: {\n            chatId: chatId,\n            type: \"message\",\n            content: responseText\n        }\n    }, {\n        method: \"PUT\",\n        url: `http://strapi:1337/car-projects/${projectId}`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`,\n            \"Content-Type\": \"application/json\"\n        },\n        payload: {\n            status: \"completed\",\n            date_end: new Date().toISOString()\n        },\n        originalChatId: chatId\n    }, {\n        method: \"PUT\",\n        url: `http://strapi:1337/workers/${msg.workerId}`,\n        headers: {\n            \"Authorization\": `Bearer ${flow.get('settings').STRAPI_JWT_SECRET}`,\n            \"Content-Type\": \"application/json\"\n        },\n        payload: {\n            work_completed: works.length,\n            salary: salary\n        },\n        originalChatId: chatId\n    }];\n} catch (err) {\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: \" + err.message\n        }\n    };\n}",
        "outputs": 3,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 840,
        "wires": [
            [],
            [],
            [
                "6e363c9512b0b0b8"
            ]
        ]
    },
    {
        "id": "6e363c9512b0b0b8",
        "type": "http request",
        "z": "a1b2c3d4.56789",
        "name": "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–∞",
        "method": "PUT",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1570,
        "y": 900,
        "wires": [
            [
                "9ab30fec2d908aa2"
            ]
        ]
    },
    {
        "id": "9ab30fec2d908aa2",
        "type": "function",
        "z": "a1b2c3d4.56789",
        "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞",
        "func": "if (msg.statusCode === 200) {\n    node.log(\"–î–∞–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã\");\n} else {\n    node.error(\"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–∞: \" + msg.payload);\n    return {\n        payload: {\n            chatId: msg.originalChatId,\n            type: \"message\",\n            content: \"‚ö†Ô∏è –ò—Ç–æ–≥ –ø–æ–¥—Å—á–∏—Ç–∞–Ω, –Ω–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞\"\n        }\n    };\n}\n\nreturn null;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1810,
        "y": 900,
        "wires": [
            [
                "3a2ade767fbdcad7"
            ]
        ]
    },
    {
        "id": "3a2ade767fbdcad7",
        "type": "telegram sender",
        "z": "a1b2c3d4.56789",
        "name": "",
        "bot": "12345678.90abcd",
        "haserroroutput": false,
        "outputs": 1,
        "x": 1870,
        "y": 960,
        "wires": [
            []
        ]
    },
    {
        "id": "a1b2c3d4e5f6",
        "type": "inject",
        "z": "d1b2c3d4e5f67890",
        "name": "Trigger Request",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 120,
        "wires": [
            [
                "b1b2c3d4e5f6"
            ]
        ]
    },
    {
        "id": "b1b2c3d4e5f6",
        "type": "http request",
        "z": "d1b2c3d4e5f67890",
        "name": "Fetch Post #1",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://jsonplaceholder.typicode.com/posts/1",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 350,
        "y": 120,
        "wires": [
            [
                "c1b2c3d4e5f6"
            ]
        ]
    },
    {
        "id": "c1b2c3d4e5f6",
        "type": "debug",
        "z": "d1b2c3d4e5f67890",
        "name": "Show Response",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 550,
        "y": 120,
        "wires": []
    }
]